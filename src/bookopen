#!/bin/sh

main()
{
	parsed_args=$(getopt -o h -n 'bookopen' -- "$@")
	getopt_exit_code=$?

	if [ $getopt_exit_code -ne 0 ]; then
		exit 1
	fi

	eval set -- "$parsed_args"

	while :; do
		case "$1" in
			-h ) usage ;;
			-- ) shift; break ;;
			* ) break ;;
		esac
	done

	dir="$1"

	[ -z "$dir" ] &&
		die 'you must specify a directory'

	find "$dir" -maxdepth 1 -type f |
		rev | cut -d '/' -f1 | rev | sort | rofi -dmenu |
		xargs -I{} sh -c "test -f '${dir}/{}' && zathura '${dir}/{}'"
}

die()
{
	printf "bookopen: %s\n" "$@" >&2
	exit 1
}

usage()
{
	echo usage: bookopen [-h] dir
	exit 0
}

main "$@"
